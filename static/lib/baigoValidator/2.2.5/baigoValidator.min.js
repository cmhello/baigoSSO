/*
v2.2.5 jQuery baigoValidator plugin 表单验证插件
(c) 2017 baigo studio - http://www.baigo.net/jquery/baigovalidator.html
License: http://www.opensource.org/licenses/mit-license.php
*/
;(function($){$.fn.baigoValidator=function(fileds,options){"use strict";if(this.length<1){return this;}
if(this.length>1){this.each(function(){$(this).baigoValidator(fileds);});return this;}
var thisForm=$(this);var el=this;var _status;var _err_count;var _numLenth;var _iii;var _chkCode;var _reg;var _status_leng;var _ajax;var _ajaxData;var _str_attachs;var _set_data;var _len;var _validate;var _validate_selector;var _validate_obj;var _msg;var _result;var _num;var _str;var _str_target;var defaults={class_name:{success:"text-success",err:"text-danger",loading:"text-info"},class_attach:{success:"is-valid",err:"is-invalid"},msg_global:{selector:{parent:".bg-validator-box",content:".bg-content",icon:".bg-icon",msg:".bg-msg",},msg:"Error",class_err:"alert-danger",class_icon:"oi oi-circle-x",tpl:"<div class=\"alert alert-dismissible bg-content\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button><span class=\"bg-icon\"></span>&nbsp;<span class=\"bg-msg\"></span></div>",delay:5000}};var opts=$.extend(true,defaults,options);var outPut=function(_msg_selector,_group_selector,_msg,_class,_attach_class){$(_msg_selector).empty();$(_msg_selector).append(_msg);$(_msg_selector).removeClass(opts.class_name.success+" "+opts.class_name.err+" "+opts.class_name.loading);$(_msg_selector).addClass(_class);$(_msg_selector).show();if(typeof _group_selector!="undefined"&&_group_selector.length>0){$(_group_selector).removeClass(opts.class_attach.success+" "+opts.class_attach.err);$(_group_selector).addClass(_attach_class);}};var getLength=function(_str){_numLenth=0;if(_str){for(_iii=0;_iii<_str.length;_iii++){_chkCode=_str.charCodeAt(_iii);if(_chkCode<0x007f){_numLenth++;}else if(_chkCode<=0x07ff){_numLenth+=2;}else if(_chkCode<=0xffff){_numLenth+=3;}else{_numLenth+=4;}}}
return _numLenth;};var verifyLeng=function(_str,_len){if(_len.min>0&&getLength(_str)<_len.min){_status="too_short";}else if(_len.max>0&&getLength(_str)>_len.max){_status="too_long";}else{_status="ok";}
return _status;};var verifyReg=function(_str,_format){switch(_format){case"date":_reg=/^[0-9]{4}-(((0?[13578]|(10|12))-(0?[1-9]|[1-2][0-9]|3[0-1]))|(0?2-(0[1-9]|[1-2][0-9]))|((0?[469]|11)-(0[1-9]|[1-2][0-9]|30)))$/;break;case"time":_reg=/^(([1-9]{1})|([0-1][0-9])|([1-2][0-3])):([0-5][0-9])(:([0-5][0-9]))?$/;break;case"datetime":_reg=/^[0-9]{4}-(((0?[13578]|(10|12))-(0?[1-9]|[1-2][0-9]|3[0-1]))|(0?2-(0[1-9]|[1-2][0-9]))|((0?[469]|11)-(0[1-9]|[1-2][0-9]|30)))\s(([1-9]{1})|([0-1][0-9])|([1-2][0-3])):([0-5][0-9])(:([0-5][0-9]))?$/;break;case"int":_reg=/^(\+|-)?\d*$/;break;case"digit":_reg=/^(\+|-)?\d*(\.\d+)*$/;break;case"email":_reg=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;break;case"url":_reg=/^((http|ftp|https):\/\/)(([a-zA-Z0-9\._-]+\.[a-zA-Z]{2,6})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,4})*(\/[a-zA-Z0-9\&%_\.\/-~-]*)?$/;break;case"alphabetDigit":_reg=/^[a-zA-Z\d-_]*$/;break;case"strDigit":_reg=/^[\u4e00-\u9fa5a-zA-Z\d-_]*$/;break;case"alias":_reg=/^[a-zA-Z\d-_]*$/;break;default:_reg="";break;}
if(_str&&_format!="text"){if(_reg.test(_str)){return true;}else{return false;}}else{return true;}};var isText=function(_str,_len,_format){_status_leng=verifyLeng(_str,_len);if(_status_leng!="ok"){_status=_status_leng;}else{if(verifyReg(_str,_format)){_status="ok";}else{_status="format_err";}}
return _status;};var isConfirm=function(_str,_str_target,_len){_status_leng=verifyLeng(_str,_len);if(_status_leng!="ok"){_status=_status_leng;}else{if(_str==_str_target){_status="ok";}else{_status="not_match";}}
return _status;};var isDigit=function(_num,_len){if(isNaN(_num)){_status="format_err";}else{if(_len.min>0&&_num<_len.min){_status="too_small";}else if(_len.max>0&&_num>_len.max){_status="too_big";}else{_status="ok";}}
return _status;};var isNum=function(_num,_len){if(_len.min>0&&_num<_len.min){_status="too_few";}else if(_len.max>0&&_num>_len.max){_status="too_many";}else{_status="ok";}
return _status;};var isAjax=function(_str,_len,_validate,_ajax,_msg,_validate_selector){switch(_ajax.type){case"digit":_status=isDigit(_str,_len);break;default:_status=isText(_str,_len,_validate.format);break;}
if(_status!="ok"){return _status;}else{_ajaxData=_ajax.key+"="+_str+"&"+new Date().getTime()+"at"+Math.random();if(_ajax.attach){_ajaxData=_ajaxData+"&"+_ajax.attach;}
if(_ajax.attach_selectors&&_ajax.attach_keys){$.each(_ajax.attach_selectors,function(_index,_selector){_str_attachs=$(_selector).val();_ajaxData=_ajaxData+"&"+_ajax.attach_keys[_index]+"="+_str_attachs;});}
$.ajax({url:_ajax.url,dataType:"json",data:_ajaxData,beforeSend:function(){outPut(_msg.selector,_validate.group,_msg.ajaxIng,opts.class_name.loading,opts.class_attach.err);},error:function(_result){outPut(_msg.selector,_validate.group,_msg.ajax_err+" status: "+_result.status,opts.class_name.err,opts.class_attach.err);},success:function(_result){switch(_result.msg){case"ok":outPut(_msg.selector,_validate.group,"",opts.class_name.success,opts.class_attach.success);break;default:outPut(_msg.selector,_validate.group,_result.msg,opts.class_name.err,opts.class_attach.err);break;}
_status=_result.msg;}});return _status;}};var verifyStr=function(_validate_obj){_set_data=fileds[_validate_obj];_len=_set_data.len;_validate=_set_data.validate;_msg=_set_data.msg;if(typeof _validate.selector=="undefined"||_validate.selector==null){_validate_selector="#"+_validate_obj;}else{_validate_selector=_validate.selector;}
if(typeof _validate.group=="undefined"||_validate.group==null){_validate.group=_validate_selector;}
if(typeof _msg.selector=="undefined"||_msg.selector==null){_msg.selector="#msg_"+_validate_obj;}
switch(_validate.type){case"digit":_str=$(_validate_selector).val();_status=isDigit(_str,_len);break;case"radio":case"checkbox":_num=$(_validate_selector+":checked").length;_status=isNum(_num,_len);break;case"select":if(_len.min>1){_num=$(_validate_selector+" :selected").length;_status=isNum(_num,_len);}else{_str=$(_validate_selector).val();_status=isText(_str,_len,"text");if(_status=="too_short"){_status="too_few";}}
break;case"ajax":_ajax=_set_data.ajax;_str=$(_validate_selector).val();_status=isAjax(_str,_len,_validate,_ajax,_msg,_validate_selector);break;case"confirm":_str_target=$(_validate.target).val();_str=$(_validate_selector).val();_status=isConfirm(_str,_str_target,_len);break;default:_str=$(_validate_selector).val();_status=isText(_str,_len,_validate.format);break;}
switch(_status){case"ok":outPut(_msg.selector,_validate.group,"",opts.class_name.success,opts.class_attach.success);_result=true;break;default:outPut(_msg.selector,_validate.group,_msg[_status],opts.class_name.err,opts.class_attach.err);_result=false;break;}
return _result;};el.verify=function(){_err_count=0;$(thisForm).find("[data-validate]:visible").each(function(){_validate_obj=$(this).data("validate");if(_validate_obj.length<1){_validate_obj=$(this).attr("id");}
if(!verifyStr(_validate_obj)){_err_count++;}});var _selector_global=opts.msg_global.selector;var _obj_global=$(_selector_global.parent);_obj_global.html(opts.msg_global.tpl);$(_selector_global.parent+" "+_selector_global.content).addClass(opts.msg_global.class_err);$(_selector_global.parent+" "+_selector_global.icon).addClass(opts.msg_global.class_icon);$(_selector_global.parent+" "+_selector_global.msg).html(opts.msg_global.msg);if(_err_count>0){_obj_global.slideDown();return false;}else{_obj_global.slideUp();return true;}};$(thisForm).find("[data-validate]:visible").change(function(){_validate_obj=$(this).data("validate");if(_validate_obj.length<1){_validate_obj=$(this).attr("id");}
verifyStr(_validate_obj);});return this;};})(jQuery);